<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" />
    <title>index</title>
  </head>
  <body>
    <h1>Hello, World!</h1>
    <div>
      <div>
        <input type="search" id="memoSearch" placeholder="title or tag" />
        <button type="button" onclick="searchMemo()">Search</button>
      </div>
      <div>
        <textarea id="memoTitle" class="title" maxlength="100" placeholder="title"></textarea>
        <textarea id="memoContents" class="content" maxlength="1000" placeholder="memo"></textarea>
        <textarea id="memoTags" class="tag" placeholder="tag"></textarea>
        <button type="button" onclick="saveMemo()">Save</button>
      </div>
      <ul id="memoList"></ul>
    </div>
  </body>
  <script>
    let key = 1;

    window.onload = function () {
      localStorage.clear();
    };

    const clearText = () => {
      document.getElementById("memoTitle").value = "";
      document.getElementById("memoContents").value = "";
      document.getElementById("memoTags").value = "";
    };

    function splitTag(tags) {
      let separatorString = /\s+/;
      let tagArray = tags.split(separatorString);
      return tagArray;
    }

    function saveMemo() {
      const memo = {
        title: document.getElementById("memoTitle").value,
        contents: document.getElementById("memoContents").value,
        tags: splitTag(document.getElementById("memoTags").value),
      };

      if (memo.title && memo.contents) {
        if (memo.title.length <= 100 && memo.contents.length <= 1000 && memo.tags.length <= 5) {
          const jsonString = JSON.stringify(memo);
          localStorage.setItem(key, jsonString);
          appendMemo();
          key++;
          clearText();
        }
      }
    }

    function appendMemo() {
      const memo = readMemo();

      const ul = document.getElementById("memoList");
      const li = document.createElement("li");
      const text = document.createTextNode(memo);
      li.appendChild(text);
      ul.appendChild(li);
    }

    function readMemo() {
      const memo = JSON.parse(localStorage.getItem(`${key}`));
      const text = "title: " + memo.title + " contents: " + memo.contents + " tags: " + memo.tags;
      console.log(text);
      return text;
    }

    function searchMemo() {
      console.log("searchMemo");
    }
  </script>
</html>
